import"../chunks/DsnmJJEf.js";import"../chunks/BYui9kYh.js";import{p as c,f as _,b as d,c as h}from"../chunks/CiTjGTXK.js";import{i as f}from"../chunks/CfwyDKc0.js";import{p as m}from"../chunks/YTqvNI6P.js";import{g as u,i as g,s as E}from"../chunks/CL3qtmpU.js";async function N(e){return await fetch(`${u()}/auth/token`,{method:"POST",body:JSON.stringify({code:e})})}var t=(e=>(e[e.NO_CODE=0]="NO_CODE",e[e.NO_TOKEN=1]="NO_TOKEN",e[e.SERVER_ERR=2]="SERVER_ERR",e))(t||{}),R=_("<div><span>登录中...</span></div>");function K(e,n){if(c(n,!1),g){const o=m.url.searchParams.get("code"),r=window.opener;o?(async()=>{try{const s=(await N(o)).headers.get("Authorization");if(!s){r.postMessage({type:"authenticate_error",error_code:t.NO_TOKEN,error:new Error("NO_TOKEN")});return}const p=s.replace("Bearer ","");E(p),r.postMessage({type:"authenticated"})}catch(a){r.postMessage({type:"authenticate_error",error_code:t.SERVER_ERR,error:a})}finally{window.close()}})():r.postMessage({type:"authenticate_error",error_code:t.NO_CODE})}f();var i=R();d(e,i),h()}export{K as component};
